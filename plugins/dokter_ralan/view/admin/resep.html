<ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#resep_umum" aria-controls="resep_umum" role="tab" data-toggle="tab">Umum</a></li>
    <li role="presentation"><a href="#resep_racikan" aria-controls="resep_racikan" role="tab" data-toggle="tab">Racikan</a></li>
</ul>

<div class="panel-default">
    <div class="panel-body">
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade in active" id="resep_umum">
                <form method="post" id="insert_form">
                <span id="error"></span>
                <div class="row clearfix" id="item_resep">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label>Nama Obat</label>
                            <select name="" class="form-control">
                                {loop: $dokter_ralan.databarang}<option>{$value.nama_brng}</option>{/loop}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label>Jumlah</label>
                            <input type="text" name="" class="form-control item_quantity" value="" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Aturan Pakai</label>
                            <select name="kd_poli" class="form-control">
                                {loop: $dokter_ralan.master_aturan_pakai}<option>{$value.aturan}</option>{/loop}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-1">
                    </div>
                </div>
                <div class="pull-right" style="padding-top:20px;">
                    <span class="btn btn-default btn-success add">Tambah</span>
                    <input type="submit" name="save" value="Simpan" class="btn btn-primary" />
                    <a href="" class="btn btn-default">Batal</a>
                </div>
                </form>
            </div>
            <div role="tabpanel" class="tab-pane fade in" id="resep_racikan">
                <div class="row clearfix" id="item_racikan">
                    <div class="clearfix" style="border-bottom: #ddd 1px solid;">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Nama Racikan</label>
                            <input type="text" name="" class="form-control" value="" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Metode Racik</label>
                            <input type="text" name="" class="form-control" value="" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Jumlah Racikan</label>
                            <input type="text" name="" class="form-control" value="" />
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Aturan Pakai</label>
                            <select name="kd_poli" class="form-control">
                                {loop: $dokter_ralan.master_aturan_pakai}<option>{$value.aturan}</option>{/loop}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div class="form-group">
                            <label>Item Obat</label>
                            <select name="nama_brng[]" class="form-control" multiple class="form-control" data-keep-open="true" data-use-dimmer="false" data-use-search="false" data-options-height="126px">
                                {loop: $dokter_ralan.databarang}<option value="{$value.kode_brng}">{$value.nama_brng}</option>{/loop}
                            </select>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="form-group">
                            <label>Keterangan</label>
                            <input type="text" name="" class="form-control" value="" />
                        </div>
                    </div>
                    <div class="col-md-1">
                    </div>
                </div>
                </div>
                <div class="pull-right" style="padding-top:20px;">
                    <button class="btn btn-default btn-success add_racikan">Tambah</button>
                    <input type="submit" name="save" value="Simpan" class="btn btn-primary" />
                    <a href="" class="btn btn-default">Batal</a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
  $(document).ready(function() {
      $(document).on('click', '.add', function(){
          var html = '';
          html += '<div class="clearfix row_resep">';
          html += '   <div class="col-md-6">';
          html += '       <div class="form-group">';
          html += '            <label class="visible-xs">Nama Obat</label>';
          html += '            <select name="" class="form-control">';
          html += '                {loop: $dokter_ralan.databarang}<option>{$value.nama_brng}</option>{/loop}';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-2">';
          html += '        <div class="form-group">';
          html += '            <label class="visible-xs">Jumlah</label>';
          html += '            <input type="text" name="" class="form-control item_quantity" value="" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-3">';
          html += '        <div class="form-group">';
          html += '            <label class="visible-xs">Aturan Pakai</label>';
          html += '            <select name="kd_poli" class="form-control">';
          html += '                {loop: $dokter_ralan.master_aturan_pakai}<option>{$value.aturan}</option>{/loop}';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-1">';
          html += '      <div class="form-group">';
          html += '            <label>&nbsp;</label>';
          html += '            <button class="btn btn-danger remove">-</button>';
          html += '        </div>';
          html += '    </div>';
          html += '</div>';
          $('#item_resep').append(html);
          $('select').each(function () {
              var options = {
                  useDimmer: true,
                  useSearch: true,
                  labels: {
                      search: '...'
                  }
              };
              $.each($(this).data(), function (key, value) {
                  options[key] = value;
              });
              $(this).selectator(options);
          });
      });

      $(document).on('click', '.remove', function(){
          $(this).closest('.row_resep').remove();
      });

      $('#insert_form').on('submit', function(event){
          event.preventDefault();
          var error = '';
          $('.item_name').each(function(){
              var count = 1;
              if($(this).val() == ''){
                  error += "<p>Enter Item Name at "+count+" Row</p>";
                  return false;
              }
              count = count + 1;
          });

          $('.item_quantity').each(function(){
              var count = 1;
              if($(this).val() == ''){
                  error += "<p>Enter Item Quantity at "+count+" Row</p>";
                  return false;
              }
              count = count + 1;
          });

          $('.item_unit').each(function(){
              var count = 1;
              if($(this).val() == ''){
                  error += "<p>Select Unit at "+count+" Row</p>";
                  return false;
              }
              count = count + 1;
          });
          var form_data = $(this).serialize();
          if(error == ''){
              $.ajax({
                  /*url:"insert.php",
                  method:"POST",
                  data:form_data,
                  success:function(data){
                      if(data == 'ok'){
                          $('#item_resep').find("tr:gt(0)").remove();
                          $('#error').html('<div class="alert alert-success">Item Details Saved</div>');
                      }
                  }*/
              });
          } else {
              $('#error').html('<div class="alert alert-danger">'+error+'</div>');
          }
      });

      $(document).on('click', '.add_racikan', function(){
          var html = '';
          html += '<div class="clearfix row_racikan" style="border-bottom: #ddd 1px solid;margin-top: 20px;">';
          html += '   <div class="col-md-3">';
          html += '       <div class="form-group">';
          html += '            <label>Nama Racikan</label>';
          html += '            <input type="text" name="" class="form-control" value="" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-3">';
          html += '        <div class="form-group">';
          html += '            <label>Metode Racikan</label>';
          html += '            <input type="text" name="" class="form-control" value="" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-3">';
          html += '        <div class="form-group">';
          html += '            <label>Jumlah Racikan</label>';
          html += '            <input type="text" name="" class="form-control" value="" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-3">';
          html += '        <div class="form-group">';
          html += '            <label>Aturan Pakai</label>';
          html += '            <select name="kd_poli" class="form-control">';
          html += '                {loop: $dokter_ralan.master_aturan_pakai}<option>{$value.aturan}</option>{/loop}';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-8">';
          html += '        <div class="form-group">';
          html += '            <label>Item Obat</label>';
          html += '            <select name="nama_brng[]" class="form-control" multiple class="form-control" data-keep-open="true" data-use-dimmer="false" data-options-height="126px">';
          html += '                {loop: $dokter_ralan.databarang}<option value="{$value.kode_brng}">{$value.nama_brng}</option>{/loop}';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-3">';
          html += '        <div class="form-group">';
          html += '            <label>Keterangan</label>';
          html += '            <input type="text" name="" class="form-control" value="" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-1">';
          html += '      <div class="form-group">';
          html += '            <label>Aksi</label>';
          html += '            <button class="btn btn-danger remove_racikan">-</button>';
          html += '        </div>';
          html += '    </div>';
          html += '</div>';
          $('#item_racikan').append(html);
          $('select').each(function () {
              var options = {
                  useDimmer: false,
                  useSearch: false,
                  labels: {
                      search: '...'
                  }
              };
              $.each($(this).data(), function (key, value) {
                  options[key] = value;
              });
              $(this).selectator(options);
          });
      });

      $(document).on('click', '.remove_racikan', function(){
          $(this).closest('.row_racikan').remove();
      });

  });
</script>
